<!DOCTYPE html>
<html>

<head>
  
<link href="http://getbootstrap.com/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Optional Bootstrap Theme -->

  <link href="data:text/css;charset=utf-8," data-href="http://getbootstrap.com/dist/css/bootstrap-theme.min.css" rel="stylesheet" id="bs-theme-stylesheet">

<!-- Documentation extras -->

<link href="http://getbootstrap.com/assets/css/docs.min.css" rel="stylesheet">

<!--[if lt IE 9]><script src="../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
<script src="http://getbootstrap.com/assets/js/ie-emulation-modes-warning.js"></script>

</head>

<body>
<div class="wrapper">

<div class="header"><div class="container clearfix">

    <a class="header-logo-invertocat" href="https://github.com/" data-hotkey="g d" aria-label="Homepage" ga-data-click="Header, go to dashboard, icon:logo">
  <span class="mega-octicon octicon-mark-github"></span>
</a>


      <div class="site-search repo-scope js-site-search" role="search">
          <form accept-charset="UTF-8" action="/Ninkip2p/ninkip2p.github.io/search" class="js-site-search-form" data-global-search-url="/search" data-repo-search-url="/Ninkip2p/ninkip2p.github.io/search" method="get"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"></div>
  <input type="text" class="js-site-search-field is-clearable" data-hotkey="s" name="q" placeholder="Search" data-global-scope-placeholder="Search GitHub" data-repo-scope-placeholder="Search" tabindex="1" autocapitalize="off">
  <div class="scope-badge">This repository</div>
</form>
      </div>
      <ul class="header-nav left" role="navigation">
        <li class="header-nav-item explore">
          <a class="header-nav-link" href="/explore" data-ga-click="Header, go to explore, text:explore">Explore</a>
        </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="https://gist.github.com" data-ga-click="Header, go to gist, text:gist">Gist</a>
          </li>
          <li class="header-nav-item">
            <a class="header-nav-link" href="/blog" data-ga-click="Header, go to blog, text:blog">Blog</a>
          </li>
        <li class="header-nav-item">
          <a class="header-nav-link" href="https://help.github.com" data-ga-click="Header, go to help, text:help">Help</a>
        </li>
      </ul>

    
<ul class="header-nav user-nav right" id="user-links">
  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link name" href="/Ninkip2p" data-ga-click="Header, go to profile, text:username">
      <img alt="Ninkip2p" class="avatar" data-user="7314013" height="20" src="https://avatars0.githubusercontent.com/u/7314013?v=3&amp;s=40" width="20">
      <span class="css-truncate">
        <span class="css-truncate-target">Ninkip2p</span>
      </span>
    </a>
  </li>

  <li class="header-nav-item dropdown js-menu-container">
    <a class="header-nav-link js-menu-target tooltipped tooltipped-s" href="#" aria-label="Create new..." data-ga-click="Header, create new, icon:add">
      <span class="octicon octicon-plus"></span>
      <span class="dropdown-caret"></span>
    </a>

    <div class="dropdown-menu-content js-menu-content">
      
<ul class="dropdown-menu">
  <li>
    <a href="/new"><span class="octicon octicon-repo"></span> New repository</a>
  </li>
  <li>
    <a href="/organizations/new"><span class="octicon octicon-organization"></span> New organization</a>
  </li>


    <li class="dropdown-divider"></li>
    <li class="dropdown-header">
      <span title="Ninkip2p/ninkip2p.github.io">This repository</span>
    </li>
      <li>
        <a href="/Ninkip2p/ninkip2p.github.io/issues/new"><span class="octicon octicon-issue-opened"></span> New issue</a>
      </li>
      <li>
        <a href="/Ninkip2p/ninkip2p.github.io/settings/collaboration"><span class="octicon octicon-person"></span> New collaborator</a>
      </li>
</ul>

    </div>
  </li>

  <li class="header-nav-item">
        <a href="/notifications" aria-label="You have no unread notifications" class="header-nav-link notification-indicator tooltipped tooltipped-s" data-ga-click="Header, go to notifications, icon:read" data-hotkey="g n">
        <span class="mail-status all-read"></span>
        <span class="octicon octicon-inbox"></span>
</a>
  </li>

  <li class="header-nav-item">
    <a class="header-nav-link tooltipped tooltipped-s" href="/settings/profile" id="account_settings" aria-label="Settings" data-ga-click="Header, go to settings, icon:settings">
      <span class="octicon octicon-gear"></span>
    </a>
  </li>

  <li class="header-nav-item">
    <form accept-charset="UTF-8" action="/logout" class="logout-form" method="post"><div style="margin:0;padding:0;display:inline"><input name="utf8" type="hidden" value="✓"><input name="authenticity_token" type="hidden" value="JJN0JoAgoAIWF/g/7qHiVrDgtXORiZEdr9Jw9u88C9qKbveOz6wjys+hRk6Y2lRM73KNAuZBH+kFd+ZhGqNvJA=="></div>
      <button class="header-nav-link sign-out-button tooltipped tooltipped-s" aria-label="Sign out" data-ga-click="Header, sign out, icon:logout">
        <span class="octicon octicon-sign-out"></span>
      </button>
</form>  </li>

</ul>


    
  </div></div>

<div class="container bs-docs-container">

<div class="row">

<div class="col-md-9">

<h3>Rationale</h3>

<p>Bitcoin addresses are difficult to exchange and require either copying and pasting or qr code scanning. This promotes address re-use which in turn can make funds vunerable to R value attacks and are detrimental to financial privacy.</p>

<p>The PGP scheme described here removes the need for exchanging bitcoin addresses everytime two users transact, and promotes zero address re-use. After the PGP validation is complete it becomes less effort to generate new addreses on behalf of each other then it does to find the previous address used for that user and copy/paste it into a transaction.</p>

<p>The server can facilitate the initial exchange, but should not be trusted, and so an out of band validation is required. Note: this should also happen over a secure channel, however this is up to the user as we have, by definition no control over the choice of channel.</p>

<p>Finally, the addresses are generated by the client and not handed off from the server, removing the threat of the server handing off bad addresses. The server acts purely as a verification service, a cross check between what the client has generated and what the server expected.</p>

<p>This provides an extra layer of security against malware on the client replacing the address before the transaction is signed and sent to our server.</p>


<h3>PGP Key Exchange</h3>


<p>The wallet supports exchanging HD public ec key nodes with other users on the service. The purpose of this is to allow
users who regularly transact with each other, to generate addresses on each other's behalf. So instead of you sending
me an address, I simply derive one from the next node on the public key chain you assinged and sent to me.</p>

<p>This presents a problem of a MIM attack when exchanging these parent nodes. How do we know the server which is 
facilitating the exchange is not compromised.</p>

<p>To solve this we use PGP with the keys generated on the client at the time of account creation and stored in an
encrypted packet, using the user's passphrase.</p>

<p>An out of band fingerprint exchange must occur between the two users in order to validate that the service or another
actor has not compromised the integrity of the key exchange. We present this fingerprint in the form of a BIP39 encoded
mnemonic reffered to as a 'Ninki Phrase'.</p>


<h3>Alice provides a node to Bob</h3>


<img src="pgp-ex.png" />


<div class="bs-callout">
<ol>

<li>Bob's PGP public key is registered with the server, we can refer to this as an untrusted public key.</li>

<li>Alice retrieves the untrusted PGP public key for Bob from the server.</li>

<li>Alice encrypts her HD node with Bob's untrusted PGP public key and signs it with her PGP private key.</li>

<li>Alice encrypts Bob's untrusted PGP public key with her PGP public key and stores on the server for future reference.</p>

<li>Bob retrieves the packet encrypted by Alice from the server and decrypts using his PGP private key.</li>

<li>Bob retrieves Alice's untrusted PGP public key from the server and validates the signature on the packet matches.</li>

<li>Bob encrypts the contents of the packet and Alice's untrusted PGP public key with his PGP public key and stores on the server for future reference.</li>

<li>Out of band, Alice sends Bob her PGP public key fingerprint</li>

<li>Bob verifies that the untrusted PGP public key he has stored for Alice matches this fingerprint.</li>

<li>Alice's PGP public key is now trusted by Bob and the integrity of the exchange is verified.</li>

</ol>
  </div>
  
<p>
Whenever Bob needs to generate an address for Alice, he retrieves the packet from the server, decrypts it with his PGP private key and derives a new address for Alice. The reverse process happens and Alice and Bob now have connected wallets. 
</p>


</div>


</div>
  
</div>
  
</div>
</body>
</html>
